<!DOCTYPE html>
<html>
  <head>
        <title>Solar Panel AR Animation</title>
        <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
        <a-scene embedded arjs>
          <!-- Marker -->
          <a-marker preset="hiro">
    
            <a-entity id="panel" position="0 0.5 0" scale="0.4 0.4 0.4">
        
        
              <a-box depth="0.05" height="1.0" width="1.6" 
               
                color="#002244"
               
                position="0 0 0"
               
                shader="flat">
        
              </a-box>
        
        
              <a-box depth="0.02" height="1.05" width="1.65" 
               
                color="#AAAAAA"
               
                position="0 0 0">
        
              </a-box>
        
        
              <a-cylinder radius="0.05" height="0.5" 
                    
                color="#666666" 
                    
                position="0 -0.25 0" 
                    
                rotation="90 0 0">
        
              </a-cylinder>

    
            </a-entity>

          </a-marker>
          <a-entity camera></a-entity>
        
        </a-scene>
    <script>
    // FIX 1: Use the local JSON file ("tilt_predictions.json") to avoid CORS errors
          const json_url = "tilt_predictions.json";

    // Animation speed (1000ms = 1 second per tilt update
          const stepDuration = 1000;
          fetch(json_url)
            .then(response => {
            // Check for network errors, crucial for local files
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status} - Could not find local file.`);
              }
            
              return response.json();
        
            })
        
            .then(data => {
            
              const panel = document.querySelector("#panel");
            
              let i = 0;

            
              function updateTilt() {
                
                if (i >= data.length) i = 0; // Loop the animation
                
                // Get the tilt value (in radians)
                const tilt_radians = data[i].tilt;
                
                // FIX 2: Convert radians to degrees (A-Frame uses degrees for rotation
                const tilt_degrees = tilt_radians * (180 / Math.PI) * 5;
                
                // Apply rotation on the X-axis (Pitch). 
                // Rotation is "X Y Z". We use a negative value for proper visual orientation.
                
                panel.setAttribute('rotation', `${-tilt_degrees} 0 0`);
                
                
                i++;
                
                setTimeout(updateTilt, stepDuration);
            
              }
            
            // Start the animation loop
            
              updateTilt();
        
            })
        
            .catch(error => {
            
              console.error('Error fetching or processing data:', error);
            // This alert helps confirm if the file loaded successfully
            
              alert("Error loading animation data. Check your browser console for details."); 
        
            });

        </script>

       
  </body>
</html>
